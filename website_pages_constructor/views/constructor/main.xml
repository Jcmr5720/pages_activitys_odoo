<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="pc_builder_page" name="Constructor de PC con menú">
        <section id="pc-builder-page" class="container my-5" t-att-data-is-public="1 if is_public else 0">
            <div id="pc-builder-loading" class="pc-builder-loading-overlay" role="status" aria-live="polite">
                <div class="pc-builder-spinner">
                    <div class="pc-builder-monitor">
                        <div class="pc-builder-monitor-header">
                            <span class="pc-builder-dot dot-red"></span>
                            <span class="pc-builder-dot dot-yellow"></span>
                            <span class="pc-builder-dot dot-green"></span>
                        </div>
                        <div class="pc-builder-monitor-body">
                            <span class="pc-builder-code-line line1"></span>
                            <span class="pc-builder-code-line line2"></span>
                            <span class="pc-builder-code-line line3"></span>
                            <span class="pc-builder-code-line line4"></span>
                        </div>
                    </div>
                    <div class="pc-builder-monitor-stand"></div>
                    <div class="pc-builder-keyboard">
                        <span class="pc-builder-key key-left"></span>
                        <span class="pc-builder-key key-middle"></span>
                        <span class="pc-builder-key key-right"></span>
                    </div>
                    <p class="pc-builder-loading-text">Compilando tus componentes...</p>
                </div>
            </div>
            <h1 class="text-center mb-4">Arma tu pc con nosotros</h1>
            <div class="row">
                <div class="col-md-3">
                    <div id="pc-builder-main-menu">
                        <ul class="list-group">
                            <t t-foreach="menu_items" t-as="menu">
                                <li t-attf-class="list-group-item main-menu-item d-flex justify-content-between align-items-center#{' active' if menu['id'] == 'base' else ''}"
                                    t-att-data-group="menu['id']"
                                    t-att-data-initial="1 if menu.get('initial') else 0">
                                    <span><t t-esc="menu['name']"/></span>
                                </li>
                            </t>
                        </ul>
                    </div>
                </div>
                <div class="col-md-5">
                    <div id="pc-builder-menu">
                        <t t-foreach="categories" t-as="cat">
                            <div class="category mb-3"
                                 t-att-data-category-id="cat['id']"
                                 t-att-data-required="1 if cat['required'] else 0"
                                 t-att-data-group="cat['group']"
                                 t-att-data-initial="1 if cat.get('initial') else 0"
                                 t-att-style="'' if cat['group'] == 'base' else 'display:none;'">
                                <button class="btn btn-secondary w-100 d-flex justify-content-between align-items-center"
                                        data-bs-toggle="collapse"
                                        t-att-data-bs-target="'#cat%s' % cat['id']">
                                    <span>
                                        <i class="fa fa-exclamation-circle status-icon text-warning me-2"></i>
                                        <t t-esc="cat['name']"/>
                                        <span t-if="cat['required']" class="text-danger">*</span>
                                    </span>
                                    <i class="fa fa-chevron-down toggle-icon"></i>
                                </button>
                                <div class="collapse mt-2"
                                     t-att-id="'cat%s' % cat['id']"
                                     data-bs-parent="#pc-builder-menu">
                                    <div class="category-search-wrapper mb-2">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text"><i class="fa fa-search"></i></span>
                                            <input type="text"
                                                   class="form-control category-search"
                                                   placeholder="Buscar en esta categoría"/>
                                        </div>
                                    </div>
                                    <nav class="category-pagination mb-2 d-none" aria-label="Paginación de productos"></nav>
                                    <div class="product-container row"></div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
                <div class="col-md-4">
                    <div id="builder-options-panel" class="options-panel card mb-3">
                        <div class="options-panel-header card-header d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">Opciones del constructor</span>
                            <button id="options-panel-toggle" class="options-panel-toggle" type="button" aria-expanded="true" aria-controls="options-panel-body">
                                <i class="fa fa-minus" aria-hidden="true"></i>
                                <span class="visually-hidden">Contraer opciones</span>
                            </button>
                        </div>
                        <div id="options-panel-body" class="options-panel-body card-body">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="toggle-out-of-stock" checked="checked"/>
                                <label class="form-check-label" for="toggle-out-of-stock">Mostrar unidades bajo pedido</label>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="toggle-compatible-only" checked="checked"/>
                                <label class="form-check-label" for="toggle-compatible-only">Mostrar solo unidades compatibles</label>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex align-items-center gap-2 flex-wrap max-products-control">
                                    <label for="max-products-per-category" class="form-label small mb-0">Máx. productos por categoría</label>
                                    <input type="number" id="max-products-per-category" class="form-control form-control-sm max-products-input" min="1" value="10" placeholder="Ingresa un número"/>
                                </div>
                            </div>
                            <p class="small text-muted mb-3">TIP: oprime la tecla &quot;ESC&quot; para contraer todas las categorías.</p>
                            <div class="d-flex flex-column flex-sm-row align-items-stretch gap-2">
                                <button id="reset-builder" class="btn btn-secondary">Reiniciar</button>
                                <button id="collapse-categories" class="btn btn-secondary">Contraer</button>
                            </div>
                        </div>
                    </div>
                    <h3 class="mb-3">Resumen de compra</h3>
                    <div id="compat-alert" class="alert alert-danger d-none"></div>
                    <ul id="summary-list" class="list-group mb-3"></ul>
                    <div class="d-flex justify-content-between align-items-center summary-total-row">
                        <span class="fw-semibold">Total:</span>
                        <span id="summary-total" class="summary-total-value fw-bold">$0</span>
                    </div>
                      <div class="d-flex gap-2 mt-3">
                          <button id="add-to-cart" class="btn btn-primary" disabled="disabled">
                              Agregar al carrito
                          </button>
                          <button id="download-quote" class="btn btn-secondary" disabled="disabled">
                              Descargar cotización
                          </button>
                          <button id="contact-advisor" class="btn btn-outline-info">
                              Contactar con un asesor
                          </button>
                      </div>
                    <div id="public-fields" class="mt-3 d-none">
                        <input type="text" id="visitor-name" class="form-control mb-2" placeholder="Nombre"/>
                        <div class="d-flex gap-2 mb-2 align-items-center">
                            <img id="phone-flag" src="/website_pages_constructor/static/description/colombia.png" alt="" style="width:24px;height:auto;"/>
                            <select id="phone-extension" class="form-select" style="width: 90px;">
                                <option value="" disabled="disabled">Extensión</option>
                                <option value="+54" data-flag="argentina">Argentina (+54)</option>
                                <option value="+55" data-flag="brasil">Brasil (+55)</option>
                                <option value="+56" data-flag="chile">Chile (+56)</option>
                                <option value="+57" data-flag="colombia" selected="selected">Colombia (+57)</option>
                                <option value="+593" data-flag="ecuador">Ecuador (+593)</option>
                                <option value="+1" data-flag="estados-unidos">Estados Unidos (+1)</option>
                                <option value="+52" data-flag="mexico">México (+52)</option>
                                <option value="+595" data-flag="paraguay">Paraguay (+595)</option>
                                <option value="+51" data-flag="peru">Perú (+51)</option>
                                <option value="+58" data-flag="venezuela">Venezuela (+58)</option>
                            </select>
                            <input type="tel" id="visitor-phone" class="form-control" placeholder="Teléfono"/>
                        </div>
                        <div id="public-required-msg" class="text-danger small d-none">Es obligatorio llenar ambos campos.</div>
                        <button id="confirm-download" class="btn btn-primary mt-2">Confirmar</button>
                    </div>
                    <div id="missing-required" class="mt-2 text-danger"></div>
                </div>
            </div>
        </section>
    </template>
</odoo>
